<!--
  @author Su Zin Kyaw
  @since  2015/11 /06-->
<!--Show Drop Down list for month-->

<?php
    use Phalcon\Filter;
    //calculate the user time offset
   
    if ($offset<0){
    $sign='-';
    $value=$offset*(-1);
    
  
  }
    else{
    $value=$offset*(-1);
    $sign='+';
} 


?> 
<section class="content-header" style="height:auto;">
          <h1>
           Attendance List
          </h1>
          <ol class="breadcrumb">
            <li><a href="#"><i class="fa fa-dashboard"></i> Home</a></li>
            <li class="active"> Attendance List</li>
          </ol>
</section>

<section class="content">
        <!-- Main content -->
        <div class="buttons">
            <?php  if(isset($timezone)){?><p  onmouseover="aa" style="font-size: 17px">Current Timezone : <font color='red'><?php echo $timezone;?></font></p><?php }?>
            <form id="frm_search" onsubmit="return false;">
<!--             <select class="select" data-toggle="select" name="month" id="month">
            <option value="">Month</option>
            <option value="01">January</option>
            <option value="02">February</option>
            <option value="03">March</option>
            <option value="04">April</option>
            <option value="05">May</option>
            <option value="06">June</option>
            <option value="07">July</option>
            <option value="08">Augusts</option>
            <option value="09">September</option>
            <option value="10">Octobers</option>
            <option value="11">November</option>
            <option value="12">December</option>
        </select>-->
            <input type="text" name="year" id="startdate" class="datepicker"  placeholder="Start Date" style="margin-top: 10px;height:28px; width: 100px;">          
            <input type="text" name="month" id="enddate"  class="datepicker"   placeholder="End Date" style="margin-top: 10px;height:28px; width: 100px;">
            
            <input type="submit" class="buttonn" value="Search" id="search">
            <!--       <a href="#" class="button" id="search">Search</a>-->
            <a href="" class="button export" onclick="Export.Export.apply(this, [$('table.listtbl'),'attendance_list.csv']);">Export</a>
        </form>
        </div><!--Button-->
<div class="demo-content" style="padding-top:2%;">
<?php $this->flashSession->output() ?>
<table class="listtbl">
<thead>
    <tr>
        <th>Date</th>
	<th>User Name</th>
	<th>Check In</th>
	<th>Late</th>
        <th>Check Out</th>
	<th>Working Time</th>
	<th>OverTime</th>
        <th>Location</th>
    </tr>
  </thead>
  <tbody style="display: none;">
  <?php
  
   $filter = new Filter();
   
	foreach ($attlist as $result) {
            //print_r($result);exit;
  ?>
    <tr>
	<td><?php echo $result->attendances->att_date; ?></td>
	<td><?php echo $filter->sanitize($result->core->member_login_name, "string"); ?></td>
<!--        check in time-->
	<td><?php $checkintime=$result->attendances->checkin_time;
        if ($sign=='-'){
            $cintime = new DateTime($checkintime);
        $cintime->add(new DateInterval('PT' . $value . 'M'));
        echo $cintime->format('H:i:s A');
        }
        else{
         $cintime = date("H:i:s A",strtotime($value." minutes",strtotime($checkintime)));
            echo $cintime;
        }
     ?>
        </td>
        
        <!--        Late-->
        <td><?php  
      $time = date("H:i:s",strtotime($value." minutes",strtotime($checkintime)));
//           
        $office_start_time='08:00:00 ';
      
        if($time>$office_start_time){
            $start=strtotime($office_start_time);
            $end=strtotime($time);
            $late=$end-$start;
        
            echo "<font color='red'>". gmdate("H:i:s",$late)."</font>";
            
        }
        ?></td>
        
<!--        check out time -->
        <td><?php $checkouttime= $result->attendances->checkout_time;
        if($checkouttime==0){
        echo "-";}
        else{
            if($sign=='-'){
        $time = new DateTime($checkouttime);
        $time->add(new DateInterval('PT' . $value . 'M'));
        echo  $time->format('H:i:s A');}
        else {
            $time = date("H:i:s A",strtotime($value." minutes",strtotime($checkouttime)));
            echo $time;
        }
        }
?></td>
        

        
<!--        Working Hour-->
	<td>
	<?php
	$start_time=strtotime($result->attendances->checkin_time);
	$end_time=strtotime($result->attendances->checkout_time);
        if ($end_time==0){
            echo "-";
        }
        else{
          $workingHour=$end_time-$start_time;
             $hours = floor($workingHour / 3600);
            $minutes = floor(($workingHour / 60) % 60);
             $seconds = $workingHour % 60;
            $workingHour = "$hours:$minutes:$seconds";
          echo $workingHour;
	}	?>  
	</td>
        
<!--        Overtime-->
	<td><?php
        
        if ($result->attendances->overtime !=0) {
                                   echo $result['overtime'];
                                } else {
                                    echo "-";
                                }
//      	$time = date($workingHour);               
////           
//        $office_start_time='08:00:00 ';
//      
//        if($time>$office_start_time){
//            $start=strtotime($office_start_time);
//            $end=strtotime($time);
//            $late=$end-$start;
//        
//            echo "<font color='red'>". gmdate("H:i:s",$late)."</font>";
//            
//        }  elseif ($time<$office_start_time) {
//            echo '-';
//        }
//        elseif($workingHour==0){
//            echo '-';
//        }
        
        
	 ?> </td>
        <td><?php echo $filter->sanitize($result->attendances->location, "string");
                
             
        ?></td>
    </tr>
    <?php
    
        }
    ?>
</tbody>
<tfoot style="display : none;"></tfoot>
</table>    
</div>
</section>
<div id="content"></div><!-- for pagination button -->


   
