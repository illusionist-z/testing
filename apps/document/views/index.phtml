<!DOCTYPE html>
<?php

if(! ini_get('date.timezone')){
    date_default_timezone_set('UTC');    
}
    
use Phalcon\Tag as Tag; ?>
<html>
    <head>

        <meta charset="UTF-8">
        <title>Attendance System</title>
        <meta content='width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no' name='viewport'>
        <?php $this->assets->outputCss() ?>
    </head>
    <body class="skin-blue sidebar-mini" >
        <?php error_reporting(0); ?>   

        <header class="main-header">
            <nav class="navbar navbar-static-top" id="fixedheader" style="margin-left:0;">   
               <ul class="nav navbar-nav"> 
                    <li>
                        <a><img id="formenuicon" class="sidebar-toggle" href="#sidepage" role="button">
                            <span class="sr-only">Toggle navigation</span>
                        </a>
                    </li> 
                </ul>
                <!-- Navbar Right Menu -->
                <div class="navbar-custom-menu">
                    <ul class="nav navbar-nav">
                        <li>
                            <a href="<?php echo $baseUri ?>help/index/searchHelp" target="_blank" class="" title="Help" id="help_icon" style="padding-top: 20px;">
                                <img id="helpicon">
                            </a>
                        </li>  
                        <!-- Notifications: style can be found in dropdown.less -->
                        <li class="dropdown notifications-menu" >
                            <a href="#" class="<?php
                            if (count($Noti) == 0) {
                                echo "nonoti";
                            } else {
                                echo "noti";
                            }
                            ?>" id="noti" style="padding-top: 20px;">
                                <img id="notiicon">
                                <span class="label label-warning"><?php
                                    if (count($Noti) == 0) {
                                        
                                    } else {
                                        echo count($Noti);
                                    }
                                    ?></span>
                            </a>
                            <div id="notificationContainer">
                                <div id="notificationTitle">Notifications</div>
                                <div id="notificationsBody" class="notifications">

                                </div>
                                <div id="notificationFooter"><a href="<?php echo $baseUri ?>/notification/index/viewall"><span style="color:white">View All</span></a></div>
                            </div>
                        </li>
                        <!-- Tasks: style can be found in dropdown.less -->

                        <!-- User Account: style can be found in dropdown.less -->
                        <li class="dropdown user user-menu">
                            <a href="#" class="dropdown-toggle" data-toggle="dropdown" style="padding-top: 20px;">
                              <span class="hidden-xs"><?php echo $this->session->user['member_login_name']; ?></span>
                            </a>
                            <ul class="dropdown-menu">
                                <!-- User image -->
                                <li class="user-header">

                                  <img src="../../public/common/img/profile1.jpg" style="box-shadow: 2px 3px 2px #428bca;width:90px;height:90px;" class="img-circle" width="30px" alt="User Image">
                                     <p>
                                        <b><?php echo $this->session->user['member_login_name']; ?></b>

                                        <small><b>Member Since </b><?php echo "<b style='color:white;font-size:13px;'>" . date("M - Y", strtotime($this->session->user['created_dt'])) . "</b>"; ?></small>
                                    </p>
                                </li>

                                <!-- Menu Footer-->
                                <li class="user-footer">

                                    <?php
                                    if ($permission == 1) {
                                        ?>
                                        <div class="pull-left">
                                            <a href="<?php echo $baseUri ?>setting/index/admin" class="btn btn-default btn-flat" id="setting"><b>Setting</b></a>
                                        </div>
                                        <?php
                                    } else {
                                        ?> 
                                        <div class="pull-left">
                                            <a href="<?php echo $baseUri ?>setting/user" class="btn btn-default btn-flat"  id="setting"><b>Setting</b></a>
                                        </div>
                                        <?php
                                    }
                                    ?>

                                    <div class="pull-right">
                                        <a href="#" class="btn btn-default btn-flat" id="btn_logout"><b>Sign out</b></a>

                                    </div>
                                </li>
                            </ul>
                        </li>

                    </ul>
                </div>                
            </nav>
        </header>

        <!-- Left side column. contains the logo and sidebar -->
        <aside class="main-sidebar" id="sidepage" style="display:none;height: auto;">
            <!-- sidebar: style can be found in sidebar.less -->
            <section class="sidebar" >
                <!-- Sidebar user panel -->                   

                <!-- sidebar menu: : style can be found in sidebar.less -->
                <aside>
                    <ul class="sidebar-menu">
                        <li class="header"><b>MAIN NAVIGATION</b></li>
                        <?php
                        $count = 1;
                        foreach ($this->session->auth as $key_name => $key_value) {

                            $top = explode(" ", $key_value["link0"]);
                            $top_link = explode(" ", $key_value["link1"]);
                            if (strpos($key_name, 'user') !== false) {
                                if ($key_name != 'show_user_notification' && $key_name != 'show_user_setting') {
                                    if (count($key_value) > 2) {
                                        if (isset($top_link[1])) {
                                            echo '<li><a href="' . $baseUri . strtolower($top[0] . $top[1]) . '/user/' . strtolower($top_link[0] . $top_link[1]) . '"><img src="../../common/img/list.png" ><span><b>' . $key_value[0] . '</b></span></a></li>';
                                        } else {
                                            echo '<li><a href="' . $baseUri . strtolower($top[0]) . '/index/index"><img src="../../common/img/list.png" ><span><b>' . $key_value[0] . '</b></span></a></li>';
                                        }
                                    } else {
                                        if (isset($top[1])) {
                                            echo '<li><a href="' . $baseUri . strtolower($top[0] . $top[1]) . '/user/' . strtolower($top[0] . $top[1]) . '"><img src="../../common/img/list.png" ><span><b>' . $key_value[0] . '</b></span></a></li>';
                                        } else {
                                            echo '<li><a href="' . $baseUri . strtolower($top[0]) . '/index/index"><img src="../../common/img/list.png" ><span><b>' . $key_value[0] . '</b></span></a></li>';
                                        }
                                    }
                                }
                            } else {
                                if ($key_name != 'show_admin_notification' && $key_name != 'show_admin_setting') {
                                    if (count($key_value) > 2) {
                                        if (isset($top_link[1])) {
                                            echo '<li><a href="' . $baseUri . strtolower($top[0] . $top[1]) . '/index/' . strtolower($top_link[0] . $top_link[1]) . '"><img id="navicon' . $count . '" ><span><b>' . $key_value[0] . '</b></span></a></li>';
                                        } else {
                                            echo '<li><a href="' . $baseUri . strtolower($top[0]) . '/index/' . strtolower($top_link[0]) . '"><img id="navicon' . $count . '" ><span><b>' . $key_value[0] . '</b></span></a></li>';
                                        }
                                    } else {
                                        if (isset($top[1])) {
                                            echo '<li><a href="' . $baseUri . strtolower($top[0] . $top[1]) . '/index"><img id="navicon' . $count . '" ><span><b>' . $key_value[0] . '</b></span></a></li>';
                                        } else {
                                            echo '<li><a href="' . $baseUri . strtolower($top[0]) . '/index"><img id="navicon' . $count . '"><span><b>' . $key_value[0] . '</b></span></a></li>';
                                        }
                                    }
                                }
                            }
                            $count++;
                        }
                        ?>
                    </ul>
            </section>
            <!-- /.sidebar -->
        </aside>

        <!-- Content Wrapper. Contains page content -->
        <div class="content-wrapper collapse-wrapper" style="height:auto;margin-left:0;">                     
            <?php
            $j = 0;
            foreach ($this->session->auth as $key_name => $key_value) {
                $top = explode(" ", $key_value["link0"]);
                if (strtolower($top[0] . $top[1]) == $module_name) {
                    if (count($key_value) > 2) {
                        echo '<div class="row"><div class="col-sm-2 link" id="side">';
                        echo '<aside class="sidebar-menu">';
                        foreach ($key_value as $name => $value) {
                            if ($j > 1) {
                                if ($j % 2 == 0) {
                                    $link_name = $value;
                                }
                                if (is_string($name)) {
                                    if ((explode(" ", $value)!== false)) {
                                        //set to link action value
                                        $v_result = explode(" ", $value);
                                        $link_val = strtolower($v_result[0] . $v_result[1]);
                                        $mod = explode(" ", $key_value["link0"]);
                                    }
                                    if (strpos($key_name, 'user') !== false) {
                                        if ($key_name == 'show_admin_user') {
                                            echo ' <li style="border-bottom:1px solid #aaa;"><a href="' . $baseUri . strtolower($mod[0] . $mod[1]) . '/index/' . $link_val . '">' . $link_name . '</a></li>';
                                        } else {
                                            echo ' <li style="border-bottom:1px solid #aaa;"><a href="' . $baseUri . strtolower($mod[0] . $mod[1]) . '/user/' . $link_val . '">' . $link_name . '</a></li>';
                                        }
                                    } else {
                                        echo ' <li style="border-bottom:1px solid #aaa;"><a href="' . $baseUri . strtolower($mod[0] . $mod[1]) . '/index/' . $link_val . '">' . $link_name . '</a></li>';
                                    }
                                }
                            }
                            $j++;
                        }
                        echo '</aside></div><div class="col-sm-10">';
                    }
                }
            }
            echo '<section class="content">';
            echo $this->getContent();
            $this->assets->outputJs();
            echo '</section></div></div>';
            ?>
            <script  type="text/javascript">var baseUri = '<?= $baseUri ?>';</script> 
        </div><!-- /.content-wrapper -->

        <footer class="main-footer" style="margin-left:0;">
            <strong>Copyright &copy; 2014-2015 <a href="">Gnext Myanmar</a>.</strong> All rights reserved.
            
        </footer>

        <div id="notidetail" style=" display:none;" class="navbar">

        </div>


    </body>
</html>
